clean-registry-ghost-image:
  stage: clean
  rules:
    - if: $ENABLE_BUILD != 'yes'
      when: never
    - if: $CI_COMMIT_MESSAGE =~ /ci-clean-nobuild/
  tags:
    - $RUNNER_TAGS
  needs:
    - get-files-from-git
  image: ${REGISTRY_DOMAIN}${CICD_NAMESPACE}${PYTHON_PROCESS_PATH}:${PYTHON_PROCESS_TAG}
  script:
    - cd ${CICD_SCRIPT_FOLDER}
    - python3 -m ${PYTHON_CLEAN_IMAGES_SCRIPT_PACKAGE}
      --delete-ghost-image
      --project-id ${CI_PROJECT_ID} 
      --token ${CICD_API_TOKEN}

clean-registry-dev-image:
  stage: clean
  rules:
    - if: $ENABLE_BUILD != 'yes'
      when: never
    - if: $CI_COMMIT_MESSAGE =~ /ci-clean-dev/
  tags:
    - $RUNNER_TAGS
  needs:
    - get-files-from-git
  image: ${REGISTRY_DOMAIN}${CICD_NAMESPACE}${PYTHON_PROCESS_PATH}:${PYTHON_PROCESS_TAG}
  script:
    - cd ${CICD_SCRIPT_FOLDER}
    - python3 -m ${PYTHON_CLEAN_IMAGES_SCRIPT_PACKAGE}
      --delete-dev-image
      --project-id ${CI_PROJECT_ID} 
      --token ${CICD_API_TOKEN}